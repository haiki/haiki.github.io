---
title: regex
date: 2022-02-13 10:31:34
categories:
- 工具
tags:
- linux
---
@[toc]


# 介绍
## 定义
正则表达式是你所定义的模式模板 （pattern template），Linux工具可以用它来过滤文本。

## 类型
Linux中的不同应用程序可能会用不同类型的正则表达式。

正则表达式是通过正则表达式引擎 （regular expression engine）实现的。

正则表达式引擎是一套底层软件，负责解释正则表达式模式并使用这些模式进行文本匹配。

在Linux中，有两种流行的正则表达式引擎：
1. POSIX基础正则表达式（basic regular expression，BRE）引擎。 
   - 大多数Linux工具都至少符合POSIX BRE引擎规范，能够识别该规范定义的所有模式符号。
   - 有些工具（比如sed编辑器）只符合了BRE引擎规范的子集。这是出于速度方面的考虑导致的，因为**sed编辑器希望能尽可能快地处理数据流中的文本**）。
2. POSIX扩展正则表达式（extended regular expression，ERE）引擎。
   - gawk程序用ERE引擎来处理它的正则表达式模式。


# BRE
## 文本字符
最基本的BRE模式是匹配数据流中的文本字符。
```
$ echo "This is a test" | sed -n '/test/p
$ echo "This is a test" | gawk '/test/{print $0}'
This is a test”
```

- 正则表达式并不关心模式在数据流中的位置。它也不关心模式出现了多少次。一旦正则表达式匹配了文本字符串中任意位置上的模式，它就会将该字符串传回Linux工具。
- 正则表达式模式都区分大小写。
- 可以在正则表达式中使用空格和数字。
  - 如果你在正则表达式中定义了空格，那么它必须出现在数据流中。甚至可以创建匹配多个连续空格的正则表达式模式。`$ sed -n '/  /p' data1`

## 特殊字符
`.*[]^${}\+?|()`

如果要用某个特殊字符作为文本字符，就必须转义——用反斜线（\） 。
- 要使用正斜线，也需要进行转义。

## 锚字符
1. 脱字符（`^`）**定义从数据流中文本行的行首开始的模式**。如果模式出现在行首之外的位置，正则表达式模式则无法匹配。要用脱字符，就必须将它放在正则表达式中指定的模式前面。

    ```
    $ echo "Books are great" | sed -n '/^Book/p'
    Books are great
    ```

    - 脱字符会在每个由换行符决定的新数据行的行首检查模式。只要模式出现在新行的行首，脱字符就能够发现它。
    - 如果你将脱字符放到模式开头之外的其他位置，那么它就跟普通字符一样，不再是特殊字符了。
    - 如果指定正则表达式模式时只用了脱字符，就不需要用反斜线来转义。
    - 但如果你在模式中先指定了脱字符，随后还有其他一些文本，那么你必须在脱字符前用转义字符。？

2. 特殊字符美元符（`$`）定义了**行尾锚点**。将这个特殊字符放在文本模式之后来指明数据行必须以该文本模式结尾。 `$ echo "This is a good book" | sed -n '/book$/p`

3. 两种字符组合
   在一些常见情况下，可以在同一行中将行首锚点和行尾锚点组合在一起使用。比如**过滤出数据流中的空白行。** `$ sed '/^$/d' data5`


## 点号字符
点号用来匹配除换行符之外的任意单个字符。它必须匹配一个字符，如果在点号字符的位置没有字符，那么模式就不成立。`$ sed -n '/.at/p' data6`


## 字符组
使用方括号来定义一个字符组。方括号中包含所有你希望出现在该字符组中的字符。相对于点字符，能限定待匹配的字母。
如果字符组中的某个字符出现在了数据流中，那它就匹配了该模式。

- 字符组中必须有个字符来匹配相应的位置。`$ echo "Yes" | sed -n '/[Yy]es/p'`
- 字符组不必只含有字母，也可以在其中使用数字。 `$ sed -n '/[0123]/p' data7`

### 排除型字符组

在正则表达式模式中，也可以反转字符组的作用。可以寻找组中没有的字符，而不是去寻找组中含有的字符。要这么做的话，只要在字符组的开头加个脱字符。

```
$ sed -n '/[^ch]at/p' data6
This test is at line four.
```

## 区间
可以用单破折线符号在字符组中表示字符区间。
- 只需要指定区间的第一个字符、单破折线以及区间的最后一个字符就行了。
- 还可以在单个字符组指定多个不连续的区间。
```
$ sed -n '/^[0-9][0-9][0-9][0-9][0-9]$/p' data8 // 数字
$ sed -n '/[c-h]at/p' data6  // 字母
$ sed -n '/[a-ch-m]at/p' data6
```

## 特殊的字符组
![BRE.png](https://s2.loli.net/2022/02/14/xt6AMXLDSKrhinB.png)

## 星号
在字符后面放置星号表明该字符必须在匹配模式的文本中出现**0次或多次**。

点号特殊字符和星号特殊字符组合起来。**这个组合能够匹配任意数量的任意字符**。它通常用在数据流中两个可能相邻或不相邻的文本字符串之间。


# 扩展正则表达式 ERE
POSIX ERE模式包括了一些可供Linux应用和工具使用的额外符号。**gawk程序能够识别ERE模式，但sed编辑器不能。**

警告记住，sed编辑器和gawk程序的正则表达式引擎之间是有区别的。gawk程序可以使用大多数扩展正则表达式模式符号，并且能提供一些额外过滤功能，而这些功能都是sed编辑器所不具备的。但正因为如此，**gawk程序在处理数据流时通常才比较慢**。

## 问号
问号表明前面的字符**可以出现0次或1次，但只限于此**。它不会匹配多次出现的字符。

与星号一样，你可以将问号和字符组一起使用。`$ echo "bt" | gawk '/b[ae]?t/{print $0}`

## 加号
加号表明前面的字符**可以出现1次或多次，但必须至少出现1次**。如果该字符没有出现，那么模式就不会匹配。

## 花括号

ERE中的花括号允许你**为可重复的正则表达式指定一个上限**。这通常称为**间隔 （interval）**。可以用两种格式来指定区间。
- m ：正则表达式准确出现m 次。
- m, n ：正则表达式至少出现m 次，至多n 次。
- 默认情况下，gawk程序不会识别正则表达式间隔。必须指定gawk程序的--re-interval 命令行选项才能识别正则表达式间隔。

```
$ echo "bet" | gawk --re-interval '/be{1,2}t/{print $0}'
bet
$ echo "bat" | gawk --re-interval '/b[ae]{1,2}t/{print $0}'
bat
```

## 管道符号
管道符号允许你在检查数据流时，用逻辑OR 方式指定正则表达式引擎要用的两个或多个模式。如果任何一个模式匹配了数据流文本，文本就通过测试。如果没有模式匹配，则数据流文本匹配失败。

`$ echo "The cat is asleep" | gawk '/cat|dog/{print $0}`

## 表达式分组
正则表达式模式也可以用圆括号进行分组。当你将正则表达式模式分组时，该组会被视为一个标准字符。可以像对普通字符一样给该组使用特殊字符。

```
$ echo "Saturday" | gawk '/Sat(urday)?/{print $0}'
Saturday
```

# 实战
```
#!/bin/bash
gawk --re-interval '/^\(?[2-9][0-9]{2}\)?(| |-|\.)[0-9]{3}( |-|\. )[0-9]{4}/{print $0}'
echo "317-555-1234" | ./isphone
```

# 引用/参考

摘录来自: [美] Richard Blum. “Linux命令行与shell脚本编程大全（第3版）。” Apple Books. 