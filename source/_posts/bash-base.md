---
title: bash_base
date: 2022-04-25 09:53:36
categories:
- 工具
tags:
- bash
---

# 变量

## 环境变量

- shell维护着一组环境变量，用来记录特定的系统信息。比如系统的名称、登录到系统上的用户名、用户的系统ID（也称为UID）、用户的默认主目录以及shell查找程序的搜索路径。可以用set 命令来显示一份完整的当前环境变量列表。
- 只要脚本在引号中出现美元符，它就会以为你在引用一个变量。要显示美元符，你必须在它前面放置一个反斜线。

## 用户变量
- 使用等号将值赋给用户变量。在变量、等号和值之间不能出现空格。`val=$val1`

## 命令替换
- 从命令输出中提取信息，并将其赋给变量。把输出赋给变量之后，就可以随意在脚本中使用了。
- 命令替换会创建一个子shell来运行对应的命令。子shell（subshell）是由运行该脚本的shell所创建出来的一个独立的子shell（child shell）。正因如此，由该子shell所执行命令是无法使用脚本中所创建的变量的。
    - 反引号字符：`testing=`date``
    - \$() 格式：：`testing=$(date)`


# 管道连接（piping） ｜

- Linux系统实际上会同时运行这两个命令，在系统内部将它们连接起来。在第一个命令产生输出的同时，输出会被立即送给第二个命令。数据传输不会用到任何中间文件或缓冲区。
- 可以在一条命令中使用任意多条管道。可以持续地将命令的输出通过管道传给其他命令来细化操作。
- 用法：`ls -al | more` 查看长文件列表


# 执行数学计算

## expr 命令

可识别少数的数学和字符串操作符
- 数学：+， -， *， /， %
- 逻辑运算： ｜， &， <，<=， > >=， !=
- 字符串：
    - STRING : REGEXP：如果REGEXP 匹配到了STRING 中的某个模式，返回该模式匹配
    - match STRING REGEXP：同上
    - substr STRING POS LENGTH：返回起始位置为POS （从1 开始计数）、长度为LENGTH 个字符的子字符
    - index STRING CHARS：返回在STRING 中找到CHARS 字符串的位置；否则，返回0
    - length STRING：返回字符串 STRING 的数值长度
    - + TOKEN：将 TOKEN 解释成字符串，即使是关键字
    - (EXPRESSION)：返回 Expression 的值
- 问题：
    - 脚本中使用，需要对 * 等符号做转义，用\： `expr 5 \* 2`
    - 将一个数学算式的结果赋给一个变量，需要使用命令替换来获取expr 命令的输出：`var3=$(expr $var2 / $var1)`


## $[ operation ] 

- 在将一个数学运算结果赋给某个变量时，可以用美元符和方括号`$[ operation ]`将数学表达式围起来。
- bash shell数学运算符只支持整数运算。z shell 支持完整的浮点数算术操作

# 退出脚本

- 退出状态码是一个0～255的整数值，在命令结束运行时由命令传给shell。可以捕获这个值并在脚本中使用：`echo $?`
    - 如果退出状态码大于 255，最终的结果是指定的数值除以256后得到的余数
- 默认情况下，shell脚本会以脚本中的最后一个命令的退出状态码退出。
    - `exit 5`
    - `exit $val`：返回变量






